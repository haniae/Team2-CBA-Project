<!DOCTYPE html>
<html>
<head>
  <title>Test Dashboard Sources Display</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .source-item { 
      border: 1px solid #ddd; 
      padding: 15px; 
      margin: 10px 0; 
      border-radius: 4px;
    }
    .source-header { 
      display: flex; 
      justify-content: space-between; 
      font-weight: 600;
      margin-bottom: 8px;
    }
    .source-link {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      color: #0066cc;
      text-decoration: none;
      margin-top: 8px;
    }
    .source-link:hover { text-decoration: underline; }
    .source-link svg { width: 14px; height: 14px; }
    .calculation { 
      background: #f5f5f5; 
      padding: 8px; 
      margin-top: 8px;
      border-radius: 3px;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <h1>Dashboard Sources Test</h1>
  <p>Testing that sources are displayed with SEC URLs and calculation formulas...</p>
  
  <div id="sources-container"></div>

  <script>
    // Load the test payload
    fetch('test_single_company_payload.json')
      .then(res => res.json())
      .then(payload => {
        console.log('Loaded payload with', payload.sources?.length || 0, 'sources');
        
        const container = document.getElementById('sources-container');
        const sources = payload.sources || [];
        
        if (sources.length === 0) {
          container.innerHTML = '<p>No sources found in payload!</p>';
          return;
        }
        
        const html = sources.map((source, i) => {
          const url = source.url || source.urls?.interactive || source.urls?.detail;
          const hasCalc = source.calculation;
          
          return `
            <div class="source-item">
              <div class="source-header">
                <span>${source.label || source.metric}</span>
                <span style="color: #666;">${source.period || 'N/A'}</span>
              </div>
              <div style="color: #666; font-size: 14px;">
                Source: ${source.source} | Value: ${source.value}
              </div>
              ${url ? `
                <a href="${url}" target="_blank" class="source-link">
                  ðŸ”— View SEC Filing
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                    <polyline points="15 3 21 3 21 9"/>
                    <line x1="10" y1="14" x2="21" y2="3"/>
                  </svg>
                </a>
              ` : '<div style="color: #999; margin-top: 8px;">No direct SEC URL</div>'}
              ${hasCalc ? `
                <div class="calculation">
                  <strong>Calculation:</strong> ${source.calculation.display || source.calculation.formula}
                  ${source.note ? `<br><em>${source.note}</em>` : ''}
                </div>
              ` : ''}
            </div>
          `;
        }).join('');
        
        container.innerHTML = html;
        
        // Count sources with URLs and calculations
        const withUrls = sources.filter(s => s.url || s.urls).length;
        const withCalc = sources.filter(s => s.calculation).length;
        const derived = sources.filter(s => s.source === 'derived').length;
        
        const summary = document.createElement('div');
        summary.style.cssText = 'background: #e8f5e9; padding: 15px; margin-bottom: 20px; border-radius: 4px;';
        summary.innerHTML = `
          <h3 style="margin-top: 0;">Summary</h3>
          <p><strong>Total sources:</strong> ${sources.length}</p>
          <p><strong>Sources with SEC URLs:</strong> ${withUrls}</p>
          <p><strong>Sources with calculation formulas:</strong> ${withCalc}</p>
          <p><strong>Derived metrics:</strong> ${derived}</p>
          <p><strong>Completeness:</strong> ${Math.round((withUrls + withCalc + derived) / sources.length * 100)}%</p>
        `;
        container.parentElement.insertBefore(summary, container);
      })
      .catch(err => {
        console.error('Error loading payload:', err);
        document.getElementById('sources-container').innerHTML = 
          '<p style="color: red;">Error loading payload: ' + err.message + '</p>';
      });
  </script>
</body>
</html>

