<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Finalyze Copilot</title>
<link href="/static/styles.css?v=20241027N" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous"/>
<link rel="icon" href="/static/favicon.svg" type="image/svg+xml"/>
</head>
<body>
<div class="layout">
<aside class="sidebar" id="sidebar">
<div class="sidebar-brand-zone">
<div class="brand-identity">
<div class="sidebar-content" id="sidebar-content">
<div aria-hidden="true" class="brand-badge">FZ</div>
<div class="brand-text">
<span class="brand-name">FinalyzeOS</span>
</div>
</div>
<button id="sidebar-toggle-header" class="sidebar-toggle" aria-label="Toggle sidebar" title="Toggle sidebar">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <line x1="3" y1="12" x2="21" y2="12"></line>
    <line x1="3" y1="6" x2="21" y2="6"></line>
    <line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</button>
</div>
<div class="brand-status sidebar-content" id="sidebar-status">
<div class="status-connection">
<span class="status-dot" id="api-status"></span>
<span id="status-message">Checking API...</span>
</div>
</div>
</div>
<div class="sidebar-rail-buttons">
<button id="sidebar-toggle" class="sidebar-toggle" aria-label="Open sidebar" title="Open sidebar">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <line x1="3" y1="12" x2="21" y2="12"></line>
    <line x1="3" y1="6" x2="21" y2="6"></line>
    <line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</button>
<button class="new-chat-icon-button" data-action="new-chat" id="new-chat-icon-button" aria-label="New chat" title="New chat">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
    <line x1="12" y1="5" x2="12" y2="19"></line>
    <line x1="5" y1="12" x2="19" y2="12"></line>
  </svg>
</button>
<button class="chats-toggle-button" data-action="open-chats" id="chats-button" aria-label="Open Chats">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
    <path d="M16 7.5a6.38 6.38 0 0 1-.7 2.8 6.5 6.5 0 0 1-5.8 3.6 6.38 6.38 0 0 1-2.8-.7L2 16l1.4-4.2a6.38 6.38 0 0 1-.7-2.8 6.5 6.5 0 0 1 3.6-5.8 6.38 6.38 0 0 1 2.8-.7h.4a6.48 6.48 0 0 1 6 6v.4z" transform="translate(-2 -1.5)" opacity="0.75"></path>
  </svg>
</button>
<button class="finance-studio-icon-button" data-action="open-finance-studio" id="finance-studio-button" aria-label="Finance Studio" title="Finance Studio" style="cursor: pointer; border: none; background: transparent; padding: 8px; display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 8px; transition: background 0.2s;">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" pointer-events="none">
    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
    <line x1="9" y1="3" x2="9" y2="21"></line>
    <line x1="3" y1="9" x2="21" y2="9"></line>
    <line x1="3" y1="15" x2="21" y2="15"></line>
    <line x1="15" y1="3" x2="15" y2="21"></line>
  </svg>
</button>
</div>
<div class="sidebar-divider sidebar-content" role="presentation" id="sidebar-divider"></div>
<nav aria-label="Analyst navigation" class="sidebar-nav sidebar-content" id="sidebar-nav">
<button class="nav-item" data-action="new-analysis">
<span aria-hidden="true" class="nav-icon">🔍</span>
<span class="nav-label">New Analysis</span>
</button>
<button class="nav-item" data-action="saved-reports">
<span aria-hidden="true" class="nav-icon">📁</span>
<span class="nav-label">Saved Reports</span>
</button>
<button class="nav-item" data-action="open-kpi-library">
<span aria-hidden="true" class="nav-icon">📊</span>
<span class="nav-label">KPI Library</span>
</button>
<button class="nav-item" data-action="open-company-universe">
<span aria-hidden="true" class="nav-icon">🏢</span>
<span class="nav-label">Company Universe</span>
</button>
<button class="nav-item" data-action="open-filing-viewer">
<span aria-hidden="true" class="nav-icon">📚</span>
<span class="nav-label">Filing Source Viewer</span>
</button>
<button class="nav-item" data-action="open-portfolio">
<span aria-hidden="true" class="nav-icon">💼</span>
<span class="nav-label">Portfolio Management</span>
</button>
<button class="nav-item" data-action="open-interactive-dashboard">
<span aria-hidden="true" class="nav-icon">📈</span>
<span class="nav-label">Interactive Dashboard</span>
</button>
<button class="nav-item" data-action="open-help">
<span aria-hidden="true" class="nav-icon">🆘</span>
<span class="nav-label">Help Center</span>
</button>
</nav>
<div class="sidebar-divider sidebar-content" role="presentation"></div>
<nav aria-label="Workspace navigation" class="sidebar-nav secondary sidebar-content">
<button class="nav-item" data-action="open-settings">
<span aria-hidden="true" class="nav-icon">⚙️</span>
<span class="nav-label">Settings</span>
</button>
<button class="nav-item" data-action="open-alerts">
<span aria-hidden="true" class="nav-icon">🔔</span>
<span class="nav-label">Alerts</span>
</button>
</nav>
<section aria-labelledby="saved-reports-heading" class="sidebar-section saved-reports sidebar-content">
<div class="section-header">
<h2 id="saved-reports-heading">Saved Reports</h2>
<button class="section-action" data-action="search-saved">
<span aria-hidden="true">🔎</span>
<span class="section-action-label">Search</span>
</button>
</div>
<div class="sidebar-search hidden" id="chat-search" role="search">
<label class="sr-only" for="chat-search-input">Search saved conversations</label>
<input autocomplete="off" id="chat-search-input" placeholder="Filter reports..." type="search"/>
<button aria-label="Clear search" class="search-clear" id="chat-search-clear" type="button">×</button>
</div>
<div class="conversation-list" id="conversation-list" role="list">
<p class="empty-state">Saved analyses will appear here.</p>
</div>
</section>
<footer class="sidebar-footer sidebar-content">
</footer>
</aside>
<main class="main-panel">
<div class="content-container"><header class="top-bar top-bar--center">
<div class="hero-copy">
<h1>Analyst Copilot</h1>
</div>
<span class="top-bar__microtag" aria-label="by Finalyze">by Finalyze</span>
</header></div>
<div class="content-container"><section aria-live="polite" class="utility-panel hidden" id="utility-panel">
<div class="utility-panel-header">
<h2 id="utility-title"></h2>
</div>
<div class="utility-content" id="utility-content"></div>
</section></div>
<div class="content-container"><section class="chats-view hidden" id="chats-view">
<div class="chats-container">
<h1 class="chats-title">Chats</h1>
<div class="chats-search-wrapper">
<input type="text" id="chats-search-input" class="chats-search-input" placeholder="Search your chats..." autocomplete="off"/>
</div>
<div class="chats-list" id="chats-list" role="list">
<p class="chats-empty">No chats found.</p>
</div>
</div>
</section></div>
<div class="content-container"><section class="finance-studio-view hidden" id="finance-studio-view">
<div id="finance-studio-root"></div>
</section></div>
<div class="content-container"><section class="chat-panel">
<section class="chat-intro" id="chat-intro"></section>
<div aria-live="polite" class="chat-log" id="chat-log"></div>

<button id="scrollBtn" title="Jump to latest" class="scroll-btn" aria-hidden="true" aria-label="Scroll to latest messages">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
    <polyline points="6 9 12 15 18 9"></polyline>
  </svg>
  <span class="sr-only">Jump to latest</span>
  </button>
<form autocomplete="off" class="chat-form" id="chat-form">
<div id="file-chips-container" class="file-chips-container" style="display: none;"></div>
<div class="chat-input-wrapper">
<textarea id="chat-input" placeholder="Ask anything about tickers or metrics… (Press Shift+Enter for new line)" required="" rows="1"></textarea>
<div class="chat-actions">
<button id="upload-button" type="button" class="chat-file-upload-btn" aria-label="Upload file" title="Upload file">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
    <polyline points="17 8 12 3 7 8"></polyline>
    <line x1="12" y1="3" x2="12" y2="15"></line>
  </svg>
  <input type="file" id="file-input" accept="*/*" style="display: none;" />
</button>
<button id="stop-button" type="button" aria-label="Stop generation" title="Stop" disabled>
  <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
    <rect x="6" y="6" width="12" height="12" rx="1"></rect>
  </svg>
</button>
<button id="send-button" type="submit" aria-label="Send message" title="Send">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
    <line x1="12" y1="19" x2="12" y2="5"></line>
    <polyline points="5 12 12 5 19 12"></polyline>
  </svg>
  </button>
</div>
</div>
</form>
</section></div>
</main>
</div>
<div id="audit-drawer" class="audit-drawer" aria-hidden="true">
  <div class="audit-drawer__overlay" data-action="close-audit"></div>
  <aside class="audit-drawer__panel" role="dialog" aria-modal="true" aria-labelledby="audit-drawer-title">
    <header class="audit-drawer__header">
      <h2 id="audit-drawer-title">Audit Trail</h2>
      <button type="button" class="audit-drawer__close" data-action="close-audit" aria-label="Close audit drawer">×</button>
    </header>
    <section class="audit-drawer__body">
      <div class="audit-drawer__summary">
        <p class="audit-drawer__status" id="audit-drawer-status">Select a metric to view lineage.</p>
        <ol class="audit-drawer__list" id="audit-drawer-list"></ol>
      </div>
      <div class="audit-drawer__detail" id="audit-drawer-detail" aria-live="polite">
        <p class="audit-drawer__placeholder">Select an audit event to inspect lineage details.</p>
      </div>
    </section>
  </aside>
</div>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" crossorigin="anonymous"></script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<link rel="stylesheet" href="/static/finance-studio.css">
<link rel="stylesheet" href="/finance-studio/styles.css">
<!-- Load Finance Studio bundle - try both locations -->
<script src="/static/finance-studio-bundle.js" onerror="console.error('Failed to load from /static/');"></script>
<script src="/finance-studio/finance-studio-bundle.js" onerror="console.error('Failed to load from /finance-studio/');"></script>
<script>
// Verify Finance Studio loaded
(function() {
  function checkLoaded() {
    if (typeof window.initFinanceStudio === 'function') {
      console.log('✓ Finance Studio bundle loaded - window.initFinanceStudio is available');
      return true;
    } else {
      console.warn('✗ Finance Studio bundle not loaded - window.initFinanceStudio is', typeof window.initFinanceStudio);
      return false;
    }
  }
  
  // Check immediately and after delays
  if (checkLoaded()) {
    console.log('Finance Studio ready immediately');
  } else {
    setTimeout(() => {
      if (checkLoaded()) {
        console.log('Finance Studio ready after 100ms');
      } else {
        setTimeout(() => {
          if (checkLoaded()) {
            console.log('Finance Studio ready after 500ms');
          } else {
            console.error('Finance Studio bundle failed to load after 500ms');
          }
        }, 400);
      }
    }, 100);
  }
})();
</script>
<script>
// Check if Finance Studio loaded
(function() {
  function checkFinanceStudio() {
    if (typeof window.initFinanceStudio === 'function') {
      console.log('✓ Finance Studio bundle loaded successfully');
    } else {
      console.warn('✗ Finance Studio bundle not loaded yet');
      // Try loading it manually if it failed
      const script = document.createElement('script');
      script.src = '/finance-studio/finance-studio-bundle.js';
      script.onload = function() {
        console.log('✓ Finance Studio bundle loaded manually');
      };
      script.onerror = function() {
        console.error('✗ Failed to load finance-studio-bundle.js - check if endpoint /finance-studio/finance-studio-bundle.js is working');
      };
      document.head.appendChild(script);
    }
  }
  // Check immediately and after a delay
  checkFinanceStudio();
  setTimeout(checkFinanceStudio, 500);
})();
</script>
<script defer="" src="/static/app.js?v=20250207161500"></script>
<script>
// Finance Studio button handler - runs immediately
(function() {
  function showFinanceStudio() {
    console.log('showFinanceStudio called');
    
    const view = document.getElementById('finance-studio-view');
    const chatPanel = document.querySelector('.chat-panel');
    const chatsView = document.getElementById('chats-view');
    const utilityPanel = document.getElementById('utility-panel');
    
    // Hide other views
    if (chatPanel) chatPanel.classList.add('hidden');
    if (chatsView) chatsView.classList.add('hidden');
    if (utilityPanel) utilityPanel.classList.add('hidden');
    
    // Show Finance Studio view
    if (view) {
      view.classList.remove('hidden');
      console.log('Finance Studio view shown');
      
      // Initialize Finance Studio content
      const root = document.getElementById('finance-studio-root');
      if (root) {
        console.log('Finance Studio view shown, root element found');
        
        // Function to try initialization
        function tryInitFinanceStudio() {
          console.log('Checking for window.initFinanceStudio...', typeof window.initFinanceStudio);
          console.log('window object keys:', Object.keys(window).filter(k => k.includes('Finance') || k.includes('init')));
          
          if (typeof window.initFinanceStudio === 'function') {
            try {
              console.log('Calling window.initFinanceStudio()');
              root.innerHTML = ''; // Clear loading message
              window.initFinanceStudio();
              console.log('initFinanceStudio() called successfully');
              
              // Verify it worked
              setTimeout(() => {
                const tiles = root.querySelectorAll('.app-tile');
                console.log('App tiles found after init:', tiles.length);
                if (tiles.length === 0) {
                  console.error('No app tiles rendered! Root HTML:', root.innerHTML.substring(0, 500));
                }
              }, 100);
            } catch (e) {
              console.error('Error initializing Finance Studio:', e);
              root.innerHTML = '<div style="padding: 2rem; text-align: center;"><h2>Finance Studio</h2><p style="color: #ef4444;">Error loading. Check console.</p><pre style="text-align: left; font-size: 0.75rem; max-width: 600px; margin: 1rem auto; background: #fee2e2; padding: 1rem; border-radius: 8px; overflow: auto;">' + e.toString() + '\n' + (e.stack || '') + '</pre></div>';
            }
          } else {
            console.warn('window.initFinanceStudio not found, will retry...');
            console.log('Available window properties:', Object.keys(window).filter(k => k.toLowerCase().includes('finance') || k.toLowerCase().includes('init')).join(', '));
            if (!root.innerHTML.includes('Loading') && !root.innerHTML.includes('Error')) {
              root.innerHTML = '<div style="padding: 2rem; text-align: center;"><h2>Finance Studio</h2><p>Loading Finance Studio...</p><p style="color: #666; font-size: 0.875rem;">Waiting for finance-studio-bundle.js to load...</p><p style="color: #999; font-size: 0.75rem;">Check console (F12) for details</p><p style="color: #999; font-size: 0.75rem;">If this persists, check Network tab for finance-studio-bundle.js</p></div>';
            }
          }
        }
        
        // Try immediately and with retries
        tryInitFinanceStudio();
        setTimeout(tryInitFinanceStudio, 100);
        setTimeout(tryInitFinanceStudio, 300);
        setTimeout(tryInitFinanceStudio, 500);
        setTimeout(tryInitFinanceStudio, 1000);
        setTimeout(tryInitFinanceStudio, 2000);
        setTimeout(tryInitFinanceStudio, 3000);
      } else {
        console.error('finance-studio-root element not found!');
      }
    }
  }
  
  function initFinanceStudioButton() {
    const button = document.getElementById('finance-studio-button');
    
    if (!button) {
      console.warn('Finance Studio button not found, will retry...');
      return false;
    }
    
    console.log('Finance Studio button found, attaching handler');
    
    // Remove any existing listeners by cloning the button
    const newButton = button.cloneNode(true);
    button.parentNode.replaceChild(newButton, button);
    
    // Add click handler with multiple event types
    newButton.onclick = function(e) {
      e.preventDefault();
      e.stopPropagation();
      console.log('Finance Studio button CLICKED via onclick!');
      showFinanceStudio();
      return false;
    };
    
    newButton.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      console.log('Finance Studio button CLICKED via addEventListener!');
      showFinanceStudio();
      return false;
    }, true); // Use capture phase
    
    newButton.addEventListener('mousedown', function(e) {
      console.log('Finance Studio button mousedown');
    });
    
    console.log('Finance Studio button handler attached successfully');
    return true;
  }
  
  // Global function for testing
  window.testFinanceStudio = function() {
    console.log('Testing Finance Studio...');
    const button = document.getElementById('finance-studio-button');
    const view = document.getElementById('finance-studio-view');
    console.log('Button:', button);
    console.log('View:', view);
    if (button) {
      button.click();
    }
  };
  
  // Try multiple times to ensure it works
  function tryInit() {
    if (!initFinanceStudioButton()) {
      setTimeout(tryInit, 200);
    }
  }
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      tryInit();
      setTimeout(tryInit, 500);
      setTimeout(tryInit, 1000);
    });
  } else {
    tryInit();
    setTimeout(tryInit, 500);
    setTimeout(tryInit, 1000);
  }
  
  // Also try on window load
  window.addEventListener('load', function() {
    setTimeout(tryInit, 100);
  });
})();
</script>
<script defer="" src="/static/voice-chatgpt.js?v=20241127"></script>
<script>
// Simple immediate health check - runs before app.js loads
(function() {
  console.log("Quick health check starting...");
  fetch('/health?ts=' + Date.now(), {
    method: 'GET',
    headers: { 'Accept': 'application/json' },
    cache: 'no-store'
  })
  .then(res => {
    if (res.ok) {
      return res.json();
    }
    throw new Error('HTTP ' + res.status);
  })
  .then(data => {
    console.log("Quick health check successful:", data);
    const statusMsg = document.getElementById("status-message");
    const statusDot = document.getElementById("api-status");
    if (statusMsg) statusMsg.textContent = "API online";
    if (statusDot) {
      statusDot.classList.remove("offline");
      statusDot.classList.add("online");
    }
  })
  .catch(err => {
    console.error("Quick health check failed:", err);
    const statusMsg = document.getElementById("status-message");
    const statusDot = document.getElementById("api-status");
    if (statusMsg) statusMsg.textContent = "Checking API...";
    if (statusDot) {
      statusDot.classList.remove("online");
      statusDot.classList.add("offline");
    }
  });
})();
</script>
</body>
</html>
