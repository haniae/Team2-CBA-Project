:root {
  --navy: #0b2e59;
  --navy-dark: #082249;
  --accent: #1c7ed6;
  --accent-light: #4dabf7;
  --accent-dark: #1864ab;
  --orange: #ff7f0e;
  --orange-light: #ffa94d;
  --green: #10b981;
  --green-light: #51cf66;
  --red: #ef4444;
  --red-light: #ff6b6b;
  --muted: #5b6b82;
  --muted-light: #8c9bb0;
  --grid: #dce4f4;
  --bg: #f3f7fc;
  --bg-gradient: linear-gradient(135deg, #f3f7fc 0%, #e8f1fa 100%);
  --card: #ffffff;
  --shadow-sm: 0 1px 3px rgba(11, 46, 89, 0.05);
  --shadow: 0 4px 12px rgba(11, 46, 89, 0.08);
  --shadow-md: 0 8px 24px rgba(11, 46, 89, 0.12);
  --shadow-lg: 0 12px 36px rgba(11, 46, 89, 0.16);
  --shadow-xl: 0 20px 48px rgba(11, 46, 89, 0.20);
  --positive: #10b981;
  --negative: #ef4444;
  --glass: rgba(255, 255, 255, 0.75);
  --glass-border: rgba(255, 255, 255, 0.3);
  --text-primary: #0b2e59;
  --text-secondary: #5b6b82;
  --border-color: rgba(220, 228, 244, 0.5);
  --header-bg: #ffffff;
  --table-header-bg: linear-gradient(135deg, #eff4fb 0%, #e8eef9 100%);
  --table-row-even: linear-gradient(135deg, rgba(243, 247, 252, 0.3) 0%, rgba(232, 241, 250, 0.3) 100%);
  --table-row-hover: linear-gradient(135deg, rgba(28, 126, 214, 0.08) 0%, rgba(28, 126, 214, 0.04) 100%);
}

/* Dark Mode - System Preference */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme="light"]) {
    --navy: #e8f1fa;
    --navy-dark: #b8d4ed;
    --accent: #4dabf7;
    --accent-light: #74c0fc;
    --accent-dark: #339af0;
    --orange: #ffa94d;
    --orange-light: #ffc078;
    --green: #51cf66;
    --green-light: #8ce99a;
    --red: #ff6b6b;
    --red-light: #ff8787;
    --muted: #a5b4c5;
    --muted-light: #c5d2e0;
    --grid: #2a3f5a;
    --bg: #0b1929;
    --bg-gradient: linear-gradient(135deg, #0b1929 0%, #0f2139 100%);
    --card: #152236;
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.2);
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.4);
    --shadow-lg: 0 12px 36px rgba(0, 0, 0, 0.5);
    --shadow-xl: 0 20px 48px rgba(0, 0, 0, 0.6);
    --positive: #51cf66;
    --negative: #ff6b6b;
    --glass: rgba(21, 34, 54, 0.75);
    --glass-border: rgba(21, 34, 54, 0.3);
    --text-primary: #e8f1fa;
    --text-secondary: #a5b4c5;
    --border-color: rgba(42, 63, 90, 0.5);
    --header-bg: #1a2a3f;
    --table-header-bg: linear-gradient(135deg, #1a2a3f 0%, #1f3146 100%);
    --table-row-even: linear-gradient(135deg, rgba(26, 42, 63, 0.3) 0%, rgba(31, 49, 70, 0.3) 100%);
    --table-row-hover: linear-gradient(135deg, rgba(77, 171, 247, 0.15) 0%, rgba(77, 171, 247, 0.08) 100%);
  }
}

/* Dark Mode - Manual Toggle */
[data-theme="dark"] {
  --navy: #e8f1fa;
  --navy-dark: #b8d4ed;
  --accent: #4dabf7;
  --accent-light: #74c0fc;
  --accent-dark: #339af0;
  --orange: #ffa94d;
  --orange-light: #ffc078;
  --green: #51cf66;
  --green-light: #8ce99a;
  --red: #ff6b6b;
  --red-light: #ff8787;
  --muted: #a5b4c5;
  --muted-light: #c5d2e0;
  --grid: #2a3f5a;
  --bg: #0b1929;
  --bg-gradient: linear-gradient(135deg, #0b1929 0%, #0f2139 100%);
  --card: #152236;
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.2);
  --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.4);
  --shadow-lg: 0 12px 36px rgba(0, 0, 0, 0.5);
  --shadow-xl: 0 20px 48px rgba(0, 0, 0, 0.6);
  --positive: #51cf66;
  --negative: #ff6b6b;
  --glass: rgba(21, 34, 54, 0.75);
  --glass-border: rgba(21, 34, 54, 0.3);
  --text-primary: #e8f1fa;
  --text-secondary: #a5b4c5;
  --border-color: rgba(42, 63, 90, 0.5);
  --header-bg: #1a2a3f;
  --table-header-bg: linear-gradient(135deg, #1a2a3f 0%, #1f3146 100%);
  --table-row-even: linear-gradient(135deg, rgba(26, 42, 63, 0.3) 0%, rgba(31, 49, 70, 0.3) 100%);
  --table-row-hover: linear-gradient(135deg, rgba(77, 171, 247, 0.15) 0%, rgba(77, 171, 247, 0.08) 100%);
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  background: var(--bg-gradient);
  background-attachment: fixed;
  color: var(--text-primary);
  font: 14px/1.6 "Inter", "Open Sans", Roboto, system-ui, -apple-system, "Segoe UI";
  font-feature-settings: "tnum", "lnum";
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  transition: background-color 0.3s ease, color 0.3s ease;
}

#cfi-root {
  max-width: 100%;
  margin: 0;
  padding: 16px 24px 32px;
  display: grid;
  grid-gap: 20px;
  grid-template-columns: repeat(12, 1fr);
  grid-template-rows: auto auto minmax(320px, auto) minmax(400px, auto) minmax(280px, auto) auto;
  grid-template-areas:
    "toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar"
    "header header header header header header header header header header header header"
    "overview overview overview overview valuation valuation valuation valuation pricechart pricechart pricechart pricechart"
    "keyfin keyfin keyfin keyfin keyfin keyfin kpi kpi kpi kpi kpi kpi"
    "trend trend trend trend rev rev rev rev ebitda ebitda ebitda ebitda"
    "sources sources sources sources sources sources sources sources sources sources sources sources";
  background: var(--bg);
  border-radius: 0;
  border: none;
  box-shadow: none;
  backdrop-filter: none;
  min-height: 100vh;
}

.cfi-panel {
  background: var(--card);
  border: 1px solid var(--border-color);
  border-radius: 14px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  box-shadow: var(--shadow);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
}

.cfi-panel::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--accent), var(--accent-light), var(--orange));
  opacity: 0;
  transition: opacity 0.3s ease;
}

.cfi-panel:hover {
  box-shadow: var(--shadow-md);
  transform: translateY(-2px);
  border-color: rgba(28, 126, 214, 0.2);
}

.cfi-panel:hover::before {
  opacity: 1;
}

.cfi-panel[data-area="header"] {
  grid-area: header;
}

.cfi-panel[data-area="overview"] {
  grid-area: overview;
}

.cfi-panel[data-area="valuation"] {
  grid-area: valuation;
}

.cfi-panel[data-area="keyfin"] {
  grid-area: keyfin;
}

.cfi-panel[data-area="kpi"] {
  grid-area: kpi;
}

.cfi-panel[data-area="pricechart"] {
  grid-area: pricechart;
}

.cfi-panel[data-area="trend"] {
  grid-area: trend;
}

.cfi-panel[data-area="peers"] {
  grid-area: peers;
}

.cfi-panel[data-area="rev"] {
  grid-area: rev;
}

.cfi-panel[data-area="ebitda"] {
  grid-area: ebitda;
}

.cfi-panel[data-area="valbar"] {
  grid-area: valbar;
}

/* Sources Panel Styles */
.cfi-panel[data-area="sources"] {
  grid-area: sources;
}

/* Hide peer comparison section */
.cfi-panel[data-area="peers"] {
  display: none;
}

/* Hide valuation bar chart */
.cfi-panel[data-area="valbar"] {
  display: none;
}

.cfi-panel[data-area="sources"] .cfi-strip {
  background: linear-gradient(135deg, #1c7ed6 0%, #2b8ce3 100%) !important;
  color: white !important;
  display: flex !important;
  justify-content: space-between !important;
  align-items: center !important;
  padding: 16px 24px !important;
  font-weight: 700 !important;
  font-size: 18px !important;
  visibility: visible !important;
}

.sources-count {
  background: rgba(255, 255, 255, 0.25);
  color: white;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 600;
  margin-left: auto;
  margin-right: 12px;
}

.toggle-sources-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: rgba(255, 255, 255, 0.95);
  border: 2px solid rgba(255, 255, 255, 0.5);
  color: #1c7ed6;
  padding: 6px 14px;
  border-radius: 20px;
  cursor: pointer;
  font-size: 13px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.toggle-sources-btn:hover {
  background: white;
  border-color: white;
  transform: translateY(-1px);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
}

.toggle-sources-btn:active {
  transform: translateY(0);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.toggle-sources-btn .chevron-icon {
  transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  flex-shrink: 0;
  width: 14px;
  height: 14px;
}

.toggle-sources-btn.collapsed .chevron-icon {
  transform: rotate(180deg);
}

.toggle-sources-btn .toggle-text {
  font-size: 12px;
}

.cfi-panel[data-area="sources"] #sources-body {
  max-height: 2000px;
  overflow: hidden;
  transition: max-height 0.4s ease, opacity 0.3s ease, padding 0.4s ease;
  opacity: 1;
  padding: 20px;
}

.cfi-panel[data-area="sources"] #sources-body.collapsed {
  max-height: 0;
  opacity: 0;
  padding: 0;
}

.sources-grid {
  display: grid !important;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 16px;
  padding: 20px;
  min-height: 100px;
  visibility: visible !important;
  opacity: 1 !important;
}

.sources-grid:empty::before {
  content: "Loading sources...";
  display: block;
  text-align: center;
  color: #666;
  padding: 40px;
  font-size: 16px;
}

.source-item {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 14px 16px;
  background: linear-gradient(135deg, #f8fbff 0%, #ffffff 100%);
  border: 1px solid rgba(220, 228, 244, 0.6);
  border-radius: 10px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.source-item::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 4px;
  background: linear-gradient(180deg, var(--accent), var(--accent-light));
  opacity: 0;
  transition: opacity 0.3s ease;
}

.source-item:hover {
  background: linear-gradient(135deg, #eff6ff 0%, #f8fbff 100%);
  border-color: var(--accent-light);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(28, 126, 214, 0.15);
}

.source-item:hover::before {
  opacity: 1;
}

.source-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.source-metric {
  font: 600 13px/1.3 "Inter", "Open Sans", Roboto;
  color: var(--navy);
  letter-spacing: 0.02em;
}

.source-period {
  font: 500 10px/1 "Inter", "Open Sans", Roboto;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  padding: 3px 8px;
  background: rgba(91, 107, 130, 0.08);
  border-radius: 4px;
  white-space: nowrap;
}

.source-link {
  font: 600 12px/1.4 "Inter", "Open Sans", Roboto;
  color: #1c7ed6;
  text-decoration: underline;
  text-decoration-color: rgba(28, 126, 214, 0.3);
  display: inline-flex;
  align-items: center;
  gap: 6px;
  transition: all 0.2s ease;
  position: relative;
  z-index: 10;
  cursor: pointer;
  pointer-events: auto;
  padding: 4px 0;
  margin: -4px 0;
}

.source-metadata {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}

.source-type-badge {
  font: 600 10px/1 "Inter", "Open Sans", Roboto;
  padding: 4px 8px;
  border-radius: 4px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.source-type-edgar,
.source-type-sec {
  background: #e3f2fd;
  color: #1976d2;
}

.source-type-derived {
  background: #f3e5f5;
  color: #7b1fa2;
}

.source-type-imf {
  background: #e8f5e9;
  color: #388e3c;
}

.source-calculation {
  margin-top: 6px;
  padding: 10px;
  background: rgba(28, 126, 214, 0.05);
  border-left: 3px solid var(--accent);
  border-radius: 4px;
  font-size: 12px;
  line-height: 1.5;
}

.source-calculation strong {
  color: var(--navy);
  font-weight: 600;
}

.source-link:hover {
  color: #1864ab;
  gap: 8px;
  text-decoration-color: #1864ab;
  text-decoration-thickness: 2px;
}

.source-link:active {
  color: #0b2e59;
}

.source-link svg {
  width: 14px;
  height: 14px;
  flex-shrink: 0;
  transition: transform 0.2s ease;
}

.source-link:hover svg {
  transform: translate(2px, -2px);
}

.source-value {
  font: 600 16px/1.2 "Inter", "Open Sans", Roboto;
  color: var(--navy);
  font-variant-numeric: tabular-nums;
}

.source-description {
  font: 400 11px/1.4 "Inter", "Open Sans", Roboto;
  color: var(--muted);
  margin-top: 4px;
}

.sources-empty {
  text-align: center;
  padding: 48px 20px;
  color: var(--muted);
}

.sources-empty-icon {
  font-size: 48px;
  margin-bottom: 16px;
  opacity: 0.3;
}

/* Dark mode adjustments for sources */
[data-theme="dark"] .source-item {
  background: linear-gradient(135deg, var(--card) 0%, #1a2a3f 100%);
  border-color: var(--border-color);
}

[data-theme="dark"] .source-item:hover {
  background: linear-gradient(135deg, #1f3146 0%, var(--card) 100%);
}

[data-theme="dark"] .source-period {
  background: rgba(165, 180, 197, 0.15);
}

/* Responsive adjustments for sources */
@media (max-width: 768px) {
  .sources-grid {
    grid-template-columns: 1fr;
  }
}

.cfi-header {
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: 0;
  background: var(--header-bg);
  position: relative;
  border: none;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  border-radius: 8px;
  overflow: hidden;
}

.cfi-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: #1A365D;
}

.cfi-header::after {
  display: none;
}

.header-top {
  display: grid;
  grid-template-columns: auto 1fr auto;
  align-items: center;
  gap: 32px;
  padding: 20px 32px;
  background: var(--header-bg);
  border-bottom: 1px solid var(--border-color);
}

.brand-stack {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 0;
  background: transparent;
  border-left: none;
  border-radius: 0;
}

.brand-row {
  display: flex;
  align-items: center;
  gap: 12px;
}

.brand-badge {
  display: none;
}

.brand-badge::after {
  display: none;
}

.brand-ticker {
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.3px;
  text-transform: uppercase;
  color: #1e293b;
  padding: 4px 10px;
  background: #f1f5f9;
  border-radius: 4px;
  border: 1px solid #e2e8f0;
  font-family: -apple-system, BlinkMacSystemFont, "Inter", system-ui, sans-serif;
}

.header-actions {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: flex-end;
  gap: 10px;
  flex-wrap: wrap;
}

.export-button {
  writing-mode: horizontal-tb;
  text-orientation: mixed;
  border: 1px solid #1e40af;
  border-radius: 6px;
  background: #ffffff;
  color: #1e40af;
  padding: 10px 18px;
  font: 600 12px/1.4 -apple-system, BlinkMacSystemFont, "Inter", system-ui, sans-serif;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  cursor: pointer;
  transition: all 0.15s ease;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
  position: relative;
  overflow: visible;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  white-space: nowrap;
  min-width: 100px;
}

.export-button::before {
  display: none;
}

.export-button:hover {
  background: #1E40AF;
  border-color: #1E40AF;
  color: #ffffff;
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(30, 64, 175, 0.2);
}

.export-button:active {
  background: #1A365D;
  border-color: #1A365D;
  transform: translateY(0);
}

.export-button:disabled,
.export-button.loading {
  background: #f8fafc;
  color: #94a3b8;
  border-color: #E0E0E0;
  cursor: not-allowed;
  opacity: 0.5;
  transform: none;
  box-shadow: none;
}

.brand-company {
  font-size: 14px;
  color: #0f172a;
  line-height: 1.5;
  font-weight: 600;
  letter-spacing: 0.02em;
  text-transform: uppercase;
  font-family: -apple-system, BlinkMacSystemFont, "Inter", system-ui, sans-serif;
}

.header-title {
  display: flex;
  flex-direction: column;
  gap: 4px;
  align-items: flex-start;
}

.header-title h1 {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
  letter-spacing: -0.01em;
  color: #0f172a;
  text-transform: none;
  opacity: 1;
  font-family: -apple-system, BlinkMacSystemFont, "Inter", system-ui, sans-serif;
}

.header-title h2 {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
  letter-spacing: -0.01em;
  color: #0f172a;
  text-transform: none;
  font-family: -apple-system, BlinkMacSystemFont, "Inter", system-ui, sans-serif;
}

.header-meta {
  display: flex;
  flex-direction: row;
  gap: 24px;
  align-items: center;
  flex-wrap: wrap;
}

.meta-item {
  display: flex;
  flex-direction: column;
  gap: 6px;
  padding: 0;
  background: transparent;
  border-radius: 0;
  border: none;
  transition: none;
}

.meta-item.recommendation {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 6px;
}

.meta-item:hover {
  background: transparent;
  border-color: transparent;
  transform: none;
  box-shadow: none;
}

.meta-label {
  font-size: 12px;
  text-transform: none;
  letter-spacing: 0;
  color: #64748b;
  font-weight: 500;
  font-family: -apple-system, BlinkMacSystemFont, "Inter", system-ui, sans-serif;
}

.meta-value {
  font-size: 18px;
  font-weight: 700;
  color: #0f172a;
  letter-spacing: -0.02em;
  font-family: -apple-system, BlinkMacSystemFont, "Inter", system-ui, sans-serif;
}

.meta-value.recommendation-pill {
  writing-mode: horizontal-tb;
  text-orientation: mixed;
  background: #1e40af;
  color: #ffffff;
  padding: 10px 20px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 700;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 80px;
  text-align: center;
}

.header-side {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 8px;
  padding: 0;
  background: transparent;
  border-radius: 0;
  border: none;
}

.header-side .meta-item {
  align-items: flex-end;
}

.cfi-logo {
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 0.3px;
  color: #6C757D;
  text-transform: uppercase;
  padding: 0;
  background: transparent;
  border-radius: 0;
  border: none;
}

.header-subline {
  font-size: 11px;
  color: #6C757D;
  display: flex;
  gap: 20px;
  align-items: center;
  padding: 10px 24px;
  background: #F8F9FA;
  border-radius: 0;
  border-left: none;
  border-top: 1px solid #E0E0E0;
  font-weight: 400;
  letter-spacing: 0;
}

.header-subline span + span::before {
  content: "•";
  margin: 0 6px;
  color: var(--grid);
}

.pill {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 600;
  text-transform: none;
  letter-spacing: 0;
  background: #1E40AF;
  color: #ffffff;
  border: none;
  box-shadow: none;
  transition: all 0.15s ease;
}

.pill:hover {
  background: #1A365D;
  box-shadow: 0 2px 4px rgba(26, 54, 93, 0.2);
  transform: translateY(-1px);
}

.cfi-strip {
  height: 38px;
  background: #1A365D;
  color: #ffffff;
  font-size: 13px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
  border-bottom: none;
  position: relative;
}

.cfi-strip::after {
  display: none;
}

@keyframes shimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

.cfi-body {
  padding: 20px;
  flex: 1;
  overflow: auto;
  background: #ffffff;
}

.cfi-body.tight {
  padding: 8px 12px;
  height: 100%;
  overflow-x: auto;
  overflow-y: hidden;
}

.plot {
  width: 100%;
  height: 240px;
  border-radius: 4px;
  background: #ffffff;
  padding: 10px;
  position: relative;
}

.plot::before {
  display: none;
}

.overview-grid {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 24px;
}

.overview-column {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.overview-column h3 {
  margin: 0 0 10px 0;
  font-size: 12px;
  font-weight: 700;
  letter-spacing: 0.02em;
  color: #1E40AF;
  text-transform: none;
  padding-bottom: 8px;
  border-bottom: 2px solid #E0E0E0;
}

.overview-table,
table[id*="price-table"],
table[id*="stat-table"],
table[id*="market-table"] {
  width: 100%;
  border-collapse: collapse;
  font-size: 12px;
  line-height: 1.4;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Inter", "Roboto", "Helvetica Neue", Arial, sans-serif;
}

.overview-table tr + tr td,
table[id*="price-table"] tr + tr td,
table[id*="stat-table"] tr + tr td,
table[id*="market-table"] tr + tr td {
  border-top: 1px solid #E0E0E0;
}

.overview-table .kv-label,
table[id*="price-table"] .kv-label,
table[id*="stat-table"] .kv-label,
table[id*="market-table"] .kv-label,
table[id*="price-table"] td:first-child,
table[id*="stat-table"] td:first-child,
table[id*="market-table"] td:first-child {
  color: #6C757D;
  text-transform: none;
  padding: 8px 0;
  font-weight: 500;
  font-size: 11px;
  text-align: left;
  vertical-align: top;
}

.overview-table .kv-value,
table[id*="price-table"] .kv-value,
table[id*="stat-table"] .kv-value,
table[id*="market-table"] .kv-value,
table[id*="price-table"] td:last-child,
table[id*="stat-table"] td:last-child,
table[id*="market-table"] td:last-child {
  text-align: right !important;
  font-variant-numeric: tabular-nums;
  color: #1E40AF;
  font-weight: 700;
  padding: 8px 0;
  font-size: 12px;
  vertical-align: top;
  white-space: nowrap;
}

.valuation-grid {
  display: grid;
  grid-template-columns: minmax(0, 1fr) 200px;
  gap: 16px;
}

.valuation-table,
table[id*="valuation-table"] {
  width: 100%;
  border-collapse: collapse;
  font: 500 12px/1.5 "Inter", "Open Sans", Roboto, -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
}

.valuation-table thead th,
table[id*="valuation-table"] thead th {
  background: #f3f6ff;
  border-bottom: 2px solid var(--grid);
  padding: 10px 12px;
  text-align: right !important;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  font-size: 11px;
  color: #0f172a;
}

.valuation-table thead th:first-child,
table[id*="valuation-table"] thead th:first-child {
  text-align: left !important;
}

.valuation-table td,
table[id*="valuation-table"] td {
  padding: 8px 12px;
  border-bottom: 1px solid #eef2fb;
  text-align: right !important;
  font-variant-numeric: tabular-nums;
  font-size: 12px;
  vertical-align: middle;
  font-weight: 500;
  color: #1e293b;
}

.valuation-table td:first-child,
table[id*="valuation-table"] td:first-child {
  text-align: left !important;
  font-weight: 600;
  color: #243554;
  font-variant-numeric: normal;
}

.valuation-table .kv-label,
table[id*="valuation-table"] .kv-label {
  text-align: left !important;
  font-weight: 600;
  color: #243554;
  padding: 8px 12px;
  font-variant-numeric: normal;
}

.valuation-table .kv-value,
table[id*="valuation-table"] .kv-value {
  text-align: right !important;
  font-variant-numeric: tabular-nums;
  font-weight: 500;
  color: #1e293b;
  padding: 8px 12px;
}

.valuation-list {
  list-style: none;
  margin: 0;
  padding: 6px 0 0 14px;
  font: 500 11px/16px "Inter", "Open Sans", Roboto;
  color: var(--muted);
  border-left: 1px solid var(--grid);
}

.valuation-list li {
  position: relative;
  padding: 2px 0;
  font-size: 10px;
}

.valuation-list li::before {
  content: "•";
  position: absolute;
  left: -12px;
  color: var(--navy);
}

.cfi-table {
  width: auto;
  min-width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  table-layout: auto;
  font: 500 13px/1.4 "Inter", "Open Sans", Roboto;
  border-radius: 6px;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(11, 46, 89, 0.05);
}

.cfi-table colgroup col:first-child {
  width: 180px;
}

.cfi-table thead th {
  position: sticky;
  top: 0;
  z-index: 2;
  background: linear-gradient(135deg, #eff4fb 0%, #e8eef9 100%);
  color: var(--navy);
  border-bottom: 2px solid var(--accent);
  font: 700 11px/1.4 "Inter", "Open Sans", Roboto, -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  text-align: right !important;
  padding: 10px 12px;
  box-shadow: 0 2px 4px rgba(11, 46, 89, 0.06);
}

.cfi-table thead th:first-child {
  position: sticky;
  left: 0;
  text-align: left !important;
  z-index: 3;
}

.cfi-table tbody td {
  border-bottom: 1px solid #e8eef7;
  padding: 8px 12px;
  height: auto;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  text-align: right !important;
  color: var(--navy);
  font-variant-numeric: tabular-nums;
  font-size: 13px;
  line-height: 1.5;
  font-weight: 500;
}

.cfi-table tbody td:first-child {
  text-align: left !important;
  font-weight: 600;
  color: #243554;
  font-variant-numeric: normal;
  white-space: normal;
}

/* Force right alignment for all numeric columns */
.cfi-table tbody td.num,
.cfi-table tbody td:not(:first-child) {
  text-align: right !important;
  font-variant-numeric: tabular-nums !important;
  font-weight: 500 !important;
}

.cfi-table tbody tr:nth-child(even) {
  background: linear-gradient(135deg, #f7fafd 0%, #fafcfe 100%);
}

.cfi-table tbody tr:hover {
  background: linear-gradient(135deg, #eff6ff 0%, #f0f7ff 100%);
  transition: background 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 2px 6px rgba(28, 126, 214, 0.08);
}

.cfi-table .metric,
.cfi-table td:first-child {
  position: sticky;
  left: 0;
  background: inherit;
  font-weight: 600;
  color: #1b2f4e;
  text-align: left !important;
  font-variant-numeric: normal;
  white-space: normal;
}

.cfi-table .num,
.cfi-table td:not(:first-child),
.cfi-table tbody td.num {
  text-align: right !important;
  font-variant-numeric: tabular-nums !important;
  font-weight: 500 !important;
  color: #10274b;
}

/* Force alignment for all data cells except first */
.cfi-table tbody tr td:not(:first-child) {
  text-align: right !important;
  font-variant-numeric: tabular-nums !important;
}

.cfi-kpi-grid {
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 12px;
}

.cfi-kpi-item {
  background: linear-gradient(135deg, #f8fbff 0%, #ffffff 100%);
  border: 1px solid rgba(220, 228, 244, 0.6);
  border-radius: 12px;
  padding: 14px 16px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  cursor: pointer;
}

.cfi-kpi-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 4px;
  height: 100%;
  background: linear-gradient(180deg, var(--accent), var(--accent-light));
  opacity: 0;
  transition: opacity 0.3s ease;
}

.cfi-kpi-item:hover {
  background: linear-gradient(135deg, #eff6ff 0%, #f8fbff 100%);
  border-color: var(--accent-light);
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(28, 126, 214, 0.18);
}

.cfi-kpi-item:hover::before {
  opacity: 1;
}

.cfi-kpi-label {
  font: 600 11px/1.3 "Inter", "Open Sans", Roboto;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  color: var(--muted);
}

.cfi-kpi-value {
  font: 700 22px/1.2 "Inter", "Open Sans", Roboto;
  color: var(--navy);
  font-variant-numeric: tabular-nums lining-nums;
  letter-spacing: -0.02em;
  position: relative;
  z-index: 1;
}

.cfi-kpi-value.positive {
  background: linear-gradient(135deg, var(--green) 0%, var(--green-light) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  font-weight: 800;
}

.cfi-kpi-value.negative {
  background: linear-gradient(135deg, var(--red) 0%, var(--red-light) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  font-weight: 800;
}

.cfi-kpi-meta {
  font: 500 10px/1.2 "Inter", "Open Sans", Roboto;
  color: #7080a3;
}

.cfi-kpi-meta.trend-up {
  color: var(--positive);
}

.cfi-kpi-meta.trend-up::before {
  content: "↑ ";
}

.cfi-kpi-meta.trend-down {
  color: var(--negative);
}

.cfi-kpi-meta.trend-down::before {
  content: "↓ ";
}

.trend-body,
.peers-body {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.trend-form,
.peer-form {
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 8px;
  align-items: end;
}

.trend-form label,
.peer-form label {
  font: 600 11px/1.4 "Inter", "Open Sans", Roboto;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  color: var(--muted);
}

.trend-form select,
.peer-form select,
.peer-form input {
  width: 100%;
  padding: 6px 8px;
  border: 1px solid var(--grid);
  border-radius: 6px;
  font: 12px "Inter", "Open Sans", Roboto;
}

.trend-form button,
.peer-form button {
  justify-self: start;
  padding: 8px 14px;
  border: none;
  border-radius: 6px;
  background: var(--accent);
  color: #fff;
  font: 600 12px "Inter", "Open Sans", Roboto;
  cursor: pointer;
  transition: background 0.2s ease, transform 0.2s ease;
}

.trend-form button:hover,
.peer-form button:hover {
  background: #155da6;
  transform: translateY(-1px);
}

.trend-chart {
  min-height: 240px;
}

.peer-status {
  font: 12px "Inter", "Open Sans", Roboto;
  color: var(--muted);
}

.peer-compare {
  min-height: 320px;
  background: #f9fbff;
  border: 1px dashed var(--grid);
  border-radius: 8px;
  overflow: hidden;
}

.peer-compare .cfi-error {
  padding: 24px;
}

.cfi-drilldown {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 2000;
}

.cfi-drilldown.visible {
  display: flex;
}

.cfi-drilldown.hidden {
  display: none;
}

.cfi-drilldown__overlay {
  position: absolute;
  inset: 0;
  background: rgba(11, 46, 89, 0.55);
}

.cfi-drilldown__panel {
  position: relative;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 18px 46px rgba(11, 46, 89, 0.22);
  width: min(840px, 92vw);
  max-height: 90vh;
  overflow-y: auto;
  padding: 24px 28px 32px;
  z-index: 1;
  display: flex;
  flex-direction: column;
  gap: 18px;
}

.cfi-drilldown__close {
  position: absolute;
  top: 12px;
  right: 12px;
  background: none;
  border: none;
  font-size: 26px;
  line-height: 1;
  color: var(--muted);
  cursor: pointer;
}

.cfi-drilldown__content h2 {
  margin: 0;
  font: 600 20px "Inter", "Open Sans", Roboto;
  color: var(--navy);
}

.drilldown-meta {
  font: 12px "Inter", "Open Sans", Roboto;
  color: var(--muted);
}

.drilldown-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 12px;
}

.drilldown-card {
  border: 1px solid var(--grid);
  border-radius: 8px;
  padding: 12px 14px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  background: #f9fbff;
}

.drilldown-card label {
  font: 600 10px/1 "Inter", "Open Sans", Roboto;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--muted);
}

.drilldown-card strong {
  font: 600 16px "Inter", "Open Sans", Roboto;
  color: var(--navy);
}

.drilldown-series {
  min-height: 260px;
}

.drilldown-table {
  width: 100%;
  border-collapse: collapse;
  font: 12px "Inter", "Open Sans", Roboto;
}

.drilldown-table th,
.drilldown-table td {
  border: 1px solid var(--grid);
  padding: 6px 8px;
  text-align: right;
}

.drilldown-table th:first-child,
.drilldown-table td:first-child {
  text-align: left;
}

.cfi-kpi-meta {
  font: 500 10px/1.2 "Inter", "Open Sans", Roboto;
  color: #7080a3;
}

.cfi-kpi-empty {
  text-align: center;
  color: var(--muted);
  font-weight: 600;
  padding: 24px 0;
}

@media (max-width: 1100px) {
  #cfi-root {
    grid-template-rows: auto;
    grid-template-areas:
      "toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar"
      "header header header header header header header header header header header header"
      "overview overview overview overview overview overview valuation valuation valuation valuation valuation valuation"
      "keyfin keyfin keyfin keyfin keyfin keyfin keyfin keyfin keyfin keyfin keyfin keyfin"
      "kpi kpi kpi kpi kpi kpi kpi kpi kpi kpi kpi kpi"
      "pricechart pricechart pricechart pricechart pricechart pricechart pricechart pricechart pricechart pricechart pricechart pricechart"
      "trend trend trend trend trend trend trend trend trend trend trend trend"
      "rev rev rev rev rev rev rev rev rev rev rev rev"
      "ebitda ebitda ebitda ebitda ebitda ebitda ebitda ebitda ebitda ebitda ebitda ebitda"
      "sources sources sources sources sources sources sources sources sources sources sources sources";
  }

  .trend-form,
  .peer-form {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .cfi-kpi-grid {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }

  .plot {
    height: 200px;
  }
}

@media (max-width: 768px) {
  #cfi-root {
    margin: 12px;
    padding: 12px;
    grid-template-columns: 1fr;
    grid-template-areas:
      "toolbar"
      "header"
      "overview"
      "valuation"
      "keyfin"
      "kpi"
      "pricechart"
      "trend"
      "rev"
      "ebitda"
      "sources";
  }

  .cfi-header {
    padding: 14px 14px 10px;
    gap: 10px;
  }

  .header-top {
    grid-template-columns: 1fr;
    align-items: flex-start;
  }

  .header-actions {
    justify-content: flex-start;
    flex-wrap: wrap;
  }

  .export-button {
    flex: 1 1 calc(50% - 6px);
    text-align: center;
  }

  .header-meta {
    flex-wrap: wrap;
    gap: 12px;
  }

  .header-side {
    align-items: flex-start;
  }

  .header-subline {
    flex-direction: column;
    gap: 4px;
  }

  .overview-grid {
    grid-template-columns: 1fr;
  }

  .valuation-grid {
    grid-template-columns: 1fr;
  }

  .cfi-kpi-grid {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .trend-form,
  .peer-form {
    grid-template-columns: 1fr;
  }

  .cfi-drilldown__panel {
    width: 94vw;
    padding: 20px;
  }
}

@media (max-width: 520px) {
  .cfi-kpi-grid {
    grid-template-columns: 1fr;
  }

  .export-button {
    flex: 1 1 100%;
  }

  .trend-form button,
  .peer-form button {
    width: 100%;
  }
}

/* ===================================================================
   DASHBOARD IMPROVEMENTS - All 10 enhancements
   =================================================================== */

/* Improvement #9: Dashboard Toolbar */
.dashboard-toolbar {
  grid-area: toolbar;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px 18px;
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 253, 0.9) 100%);
  border: 1px solid rgba(220, 228, 244, 0.5);
  border-radius: 14px;
  gap: 16px;
  box-shadow: var(--shadow);
  backdrop-filter: blur(10px);
  position: relative;
}

.dashboard-toolbar::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 14px;
  background: linear-gradient(135deg, rgba(28, 126, 214, 0.02) 0%, rgba(255, 127, 14, 0.02) 100%);
  pointer-events: none;
}

.toolbar-left, .toolbar-right {
  display: flex;
  align-items: center;
  gap: 12px;
}

.dashboard-switcher {
  padding: 8px 12px;
  border: 1px solid var(--grid);
  border-radius: 8px;
  background: white;
  font: 600 13px "Inter", "Open Sans", Roboto;
  color: var(--navy);
  cursor: pointer;
  transition: all 0.2s ease;
}

.dashboard-switcher:hover {
  border-color: var(--accent);
  box-shadow: 0 2px 6px rgba(28, 126, 214, 0.12);
}

/* Improvement #2: Search Container */
.search-container {
  position: relative;
  display: flex;
  align-items: center;
}

.dashboard-search {
  padding: 8px 12px 8px 36px;
  border: 1px solid var(--grid);
  border-radius: 8px;
  background: white;
  font: 13px "Inter", "Open Sans", Roboto;
  color: var(--navy);
  width: 260px;
  transition: all 0.2s ease;
}

.dashboard-search:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(28, 126, 214, 0.1);
  width: 320px;
}

.search-icon {
  position: absolute;
  left: 12px;
  pointer-events: none;
  opacity: 0.5;
}

/* Improvement #1: Data Freshness Indicator */
.data-freshness {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border-radius: 8px;
  background: white;
  border: 1px solid var(--grid);
  font: 600 12px "Inter", "Open Sans", Roboto;
}

.freshness-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  animation: pulse 2s ease-in-out infinite;
}

.freshness-dot.fresh {
  background: var(--positive);
}

.freshness-dot.recent {
  background: #f59e0b;
}

.freshness-dot.stale {
  background: var(--negative);
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.freshness-text {
  color: var(--muted);
  white-space: nowrap;
}

.toolbar-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  border: 1px solid var(--grid);
  border-radius: 8px;
  background: white;
  color: var(--navy);
  cursor: pointer;
  transition: all 0.2s ease;
}

.toolbar-button:hover {
  background: var(--accent);
  border-color: var(--accent);
  color: white;
  transform: rotate(180deg);
}

.toolbar-button svg {
  transition: transform 0.3s ease;
}

/* Improvement #8: KPI Category Groups */
.kpi-category {
  margin-bottom: 20px;
}

.kpi-category-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 14px;
  background: linear-gradient(135deg, #f0f5fc 0%, #e8eef9 100%);
  border-radius: 10px;
  margin-bottom: 14px;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  user-select: none;
  border: 1px solid rgba(220, 228, 244, 0.5);
  box-shadow: 0 2px 8px rgba(11, 46, 89, 0.04);
  position: relative;
  overflow: hidden;
}

.kpi-category-header::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 4px;
  background: linear-gradient(180deg, var(--accent), var(--accent-light));
  opacity: 0;
  transition: opacity 0.3s ease;
}

.kpi-category-header:hover {
  background: linear-gradient(135deg, #e8eef9 0%, #dfe8f6 100%);
  box-shadow: 0 4px 12px rgba(11, 46, 89, 0.08);
  transform: translateX(4px);
}

.kpi-category-header:hover::before {
  opacity: 1;
}

.kpi-category-title {
  display: flex;
  align-items: center;
  gap: 8px;
  font: 700 13px "Inter", "Open Sans", Roboto;
  color: var(--navy);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.kpi-category-icon {
  font-size: 16px;
}

.kpi-category-toggle {
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--accent);
  transition: transform 0.2s ease;
}

.kpi-category.collapsed .kpi-category-toggle {
  transform: rotate(-90deg);
}

.kpi-category.collapsed .kpi-category-content {
  display: none;
}

.kpi-category-content {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 12px;
}

.strip-action {
  margin-left: auto;
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.8);
  cursor: pointer;
  padding: 2px 6px;
  border-radius: 4px;
  transition: all 0.2s ease;
}

.strip-action:hover {
  background: rgba(255, 255, 255, 0.15);
  color: white;
}

/* Trend Explorer Styling */
.trend-body {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.trend-form {
  display: grid;
  grid-template-columns: auto 1fr auto 1fr auto;
  gap: 12px;
  align-items: center;
  padding: 16px;
  background: #F8F9FA;
  border-radius: 6px;
  border: 1px solid #E0E0E0;
}

.trend-form label {
  font-size: 12px;
  font-weight: 600;
  color: #6C757D;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.trend-form select {
  padding: 8px 12px;
  border: 1px solid #E0E0E0;
  border-radius: 4px;
  background: #ffffff;
  color: #1E40AF;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s ease;
}

.trend-form select:hover {
  border-color: #1E40AF;
  box-shadow: 0 2px 4px rgba(30, 64, 175, 0.1);
}

.trend-form select:focus {
  outline: none;
  border-color: #1E40AF;
  box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
}

.trend-form button {
  padding: 8px 20px;
  background: #1E40AF;
  color: #ffffff;
  border: none;
  border-radius: 4px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s ease;
  text-transform: none;
}

.trend-form button:hover {
  background: #1A365D;
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(30, 64, 175, 0.3);
}

.trend-form button:active {
  transform: translateY(0);
}

.trend-form button:disabled {
  background: #cbd5e1;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.trend-chart {
  min-height: 320px;
  background: #ffffff;
  border-radius: 4px;
  padding: 10px;
}

/* Peer Comparison Styling */
.peers-body {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.peer-form {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 12px 16px;
  align-items: center;
  padding: 20px;
  background: #F8F9FA;
  border-radius: 6px;
  border: 1px solid #E0E0E0;
}

.peer-form label {
  font-size: 12px;
  font-weight: 600;
  color: #6C757D;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.peer-form select,
.peer-form input[type="text"] {
  padding: 10px 14px;
  border: 1px solid #E0E0E0;
  border-radius: 4px;
  background: #ffffff;
  color: #1E40AF;
  font-size: 13px;
  font-weight: 500;
  transition: all 0.15s ease;
}

.peer-form select:hover,
.peer-form input[type="text"]:hover {
  border-color: #1E40AF;
  box-shadow: 0 2px 4px rgba(30, 64, 175, 0.1);
}

.peer-form select:focus,
.peer-form input[type="text"]:focus {
  outline: none;
  border-color: #1E40AF;
  box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
}

.peer-form input[type="text"]::placeholder {
  color: #94a3b8;
  font-weight: 400;
}

.peer-form button {
  grid-column: span 2;
  padding: 10px 24px;
  background: #1E40AF;
  color: #ffffff;
  border: none;
  border-radius: 4px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s ease;
  text-transform: none;
  margin-top: 8px;
}

.peer-form button:hover {
  background: #1A365D;
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(30, 64, 175, 0.3);
}

.peer-form button:active {
  transform: translateY(0);
}

.peer-status {
  font-size: 12px;
  color: #6C757D;
  padding: 10px 16px;
  background: #EEF2FF;
  border-left: 3px solid #1E40AF;
  border-radius: 4px;
  font-weight: 500;
}

.peer-compare {
  min-height: 400px;
  background: #ffffff;
  border-radius: 6px;
  border: 1px solid #E0E0E0;
  padding: 16px;
}

.peer-compare.embed {
  border: none;
  padding: 0;
}

.cfi-loading {
  text-align: center;
  padding: 40px 20px;
  color: #6C757D;
  font-size: 14px;
  font-weight: 500;
}

.cfi-error {
  text-align: center;
  padding: 40px 20px;
  color: #DC3545;
  font-size: 14px;
  font-weight: 500;
  background: #FEF2F2;
  border-radius: 4px;
  border: 1px solid #FEE2E2;
}

/* Improvement #4: Loading States / Skeleton Screens */
.skeleton-kpi-grid {
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 12px;
}

.skeleton-kpi-item {
  background: linear-gradient(90deg, #f0f4fb 25%, #e5edf8 50%, #f0f4fb 75%);
  background-size: 200% 100%;
  animation: skeleton-loading 1.5s ease-in-out infinite;
  border-radius: 10px;
  height: 90px;
}

@keyframes skeleton-loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

.skeleton-table {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.skeleton-row {
  background: linear-gradient(90deg, #f0f4fb 25%, #e5edf8 50%, #f0f4fb 75%);
  background-size: 200% 100%;
  animation: skeleton-loading 1.5s ease-in-out infinite;
  border-radius: 6px;
  height: 32px;
}

/* Improvement #7: Error State */
.error-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 48px 24px;
  text-align: center;
  background: #fef2f2;
  border: 1px solid #fecaca;
  border-radius: 12px;
  min-height: 200px;
}

.error-icon {
  font-size: 48px;
  margin-bottom: 16px;
}

.error-title {
  margin: 0 0 8px;
  font: 600 18px "Inter", "Open Sans", Roboto;
  color: var(--navy);
}

.error-message {
  margin: 0 0 20px;
  font: 14px "Inter", "Open Sans", Roboto;
  color: var(--muted);
  max-width: 400px;
}

.retry-button {
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  background: var(--accent);
  color: white;
  font: 600 14px "Inter", "Open Sans", Roboto;
  cursor: pointer;
  transition: all 0.2s ease;
}

.retry-button:hover {
  background: #155da6;
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(28, 126, 214, 0.2);
}

/* Improvement #10: Export Preview Modal */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(11, 46, 89, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  backdrop-filter: blur(4px);
}

.modal-dialog {
  background: white;
  border-radius: 16px;
  box-shadow: 0 24px 60px rgba(11, 46, 89, 0.3);
  width: min(520px, 90vw);
  max-height: 85vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  animation: modalFadeIn 0.2s ease-out;
}

@keyframes modalFadeIn {
  from {
    opacity: 0;
    transform: scale(0.95) translateY(-20px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px 24px;
  border-bottom: 1px solid var(--grid);
}

.modal-header h3 {
  margin: 0;
  font: 600 18px "Inter", "Open Sans", Roboto;
  color: var(--navy);
}

.modal-close {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: none;
  background: none;
  font-size: 24px;
  color: var(--muted);
  cursor: pointer;
  border-radius: 6px;
  transition: all 0.2s ease;
}

.modal-close:hover {
  background: #f0f4fb;
  color: var(--navy);
}

.modal-body {
  padding: 24px;
  overflow-y: auto;
  flex: 1;
}

.preview-info {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.preview-item {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.preview-label {
  font: 600 12px "Inter", "Open Sans", Roboto;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

#preview-format,
#preview-company,
#preview-size {
  font: 14px "Inter", "Open Sans", Roboto;
  color: var(--navy);
}

#preview-includes {
  margin: 0;
  padding-left: 20px;
  font: 14px "Inter", "Open Sans", Roboto;
  color: var(--navy);
}

#preview-includes li {
  margin: 4px 0;
}

.modal-footer {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
  padding: 16px 24px;
  border-top: 1px solid var(--grid);
  background: #f8fafd;
}

.modal-button {
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  font: 600 14px "Inter", "Open Sans", Roboto;
  cursor: pointer;
  transition: all 0.2s ease;
}

.modal-button.secondary {
  background: white;
  color: var(--navy);
  border: 1px solid var(--grid);
}

.modal-button.secondary:hover {
  background: #f0f4fb;
  border-color: var(--accent);
}

.modal-button.primary {
  background: var(--accent);
  color: white;
}

.modal-button.primary:hover {
  background: #155da6;
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(28, 126, 214, 0.2);
}

/* Improvement #3: Mobile Responsiveness Enhancements */
@media (max-width: 768px) {
  .dashboard-toolbar {
    flex-direction: column;
    align-items: stretch;
  }
  
  .toolbar-left, .toolbar-right {
    flex-direction: column;
    align-items: stretch;
  }
  
  .dashboard-search {
    width: 100%;
  }
  
  .dashboard-search:focus {
    width: 100%;
  }
  
  .kpi-category-content {
    grid-template-columns: 1fr;
  }
  
  .skeleton-kpi-grid {
    grid-template-columns: 1fr;
  }
}

/* Improvement #5: Chart Interactivity Enhancements */
.chart-actions {
  position: absolute;
  top: 8px;
  right: 8px;
  display: flex;
  gap: 6px;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.cfi-panel:hover .chart-actions {
  opacity: 1;
}

.chart-action-btn {
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--grid);
  border-radius: 6px;
  background: white;
  color: var(--navy);
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 12px;
}

.chart-action-btn:hover {
  background: var(--accent);
  border-color: var(--accent);
  color: white;
}

/* Improvement #6: Unified Design - Color Consistency */
:root {
  --navy: #0b2e59;
  --accent: #1c7ed6;
  --orange: #ff7f0e;
  --green: #10b981;
  --red: #ef4444;
  --muted: #5b6b82;
  --grid: #dce4f4;
  --bg: #f3f7fc;
  --card: #ffffff;
  --positive: #10b981;
  --negative: #ef4444;
}

/* Keyboard Shortcuts Modal */
.shortcuts-dialog {
  max-width: 480px;
}

.shortcuts-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
}

.shortcut-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  background: #f8fafd;
  border-radius: 8px;
  border: 1px solid var(--grid);
}

.shortcut-item kbd {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 32px;
  height: 32px;
  padding: 0 8px;
  background: white;
  border: 2px solid var(--grid);
  border-radius: 6px;
  font: 600 13px "SF Mono", Monaco, "Cascadia Code", monospace;
  color: var(--navy);
  box-shadow: 0 2px 4px rgba(11, 46, 89, 0.08);
}

.shortcut-item span {
  font: 14px "Inter", "Open Sans", Roboto;
  color: var(--navy);
}

@media (max-width: 520px) {
  .shortcuts-grid {
    grid-template-columns: 1fr;
  }
}

/* ========================================
   COLLAPSIBLE PANEL FUNCTIONALITY
   ======================================== */

.collapsible-panel {
  transition: all 0.3s ease;
}

.collapsible-header {
  cursor: pointer;
  user-select: none;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.2s ease;
}

.collapsible-header:hover {
  background: linear-gradient(90deg, #e8f2ff 0%, #f0f7ff 100%);
}

.collapsible-header.collapsed {
  border-bottom: none;
}

.toggle-panel-btn {
  background: transparent;
  border: none;
  padding: 4px 8px;
  cursor: pointer;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  color: var(--navy);
}

.toggle-panel-btn:hover {
  background: rgba(28, 126, 214, 0.1);
  transform: scale(1.1);
}

.toggle-panel-btn svg {
  transition: transform 0.3s ease;
}

.collapsible-header.collapsed .toggle-panel-btn svg {
  transform: rotate(-90deg);
}

.collapsible-content {
  max-height: 5000px;
  overflow: hidden;
  transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), 
              padding 0.3s ease,
              opacity 0.3s ease;
  opacity: 1;
}

.collapsible-content.collapsed {
  max-height: 0;
  padding-top: 0;
  padding-bottom: 0;
  opacity: 0;
}

.collapsible-panel.collapsed {
  box-shadow: var(--shadow-sm);
}

/* ========================================
   COMPREHENSIVE NEW IMPROVEMENTS
   ======================================== */

/* Theme Toggle Button */
.theme-toggle {
  width: 36px;
  height: 36px;
  border: 1px solid var(--border-color);
  border-radius: 8px;
  background: var(--card);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.theme-toggle::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, var(--accent), var(--orange));
  opacity: 0;
  transition: opacity 0.3s ease;
}

.theme-toggle:hover {
  transform: scale(1.1);
  border-color: var(--accent);
  box-shadow: 0 4px 12px rgba(28, 126, 214, 0.2);
}

.theme-toggle:hover::before {
  opacity: 0.1;
}

.theme-toggle svg {
  width: 18px;
  height: 18px;
  color: var(--text-primary);
  transition: all 0.3s ease;
  position: relative;
  z-index: 1;
}

/* Light/Dark Mode Icons */
.theme-icon-light,
.theme-icon-dark {
  transition: transform 0.3s ease, opacity 0.3s ease;
}

[data-theme="dark"] .theme-icon-light {
  transform: rotate(180deg);
  opacity: 0;
  position: absolute;
}

[data-theme="dark"] .theme-icon-dark {
  transform: rotate(0deg);
  opacity: 1;
}

[data-theme="light"] .theme-icon-dark,
:root:not([data-theme="dark"]) .theme-icon-dark {
  transform: rotate(-180deg);
  opacity: 0;
  position: absolute;
}

/* Density Controls */
.density-control {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px;
  background: var(--card);
  border: 1px solid var(--border-color);
  border-radius: 8px;
}

.density-btn {
  padding: 6px 12px;
  border: none;
  background: transparent;
  color: var(--text-secondary);
  font: 600 11px "Inter", sans-serif;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  cursor: pointer;
  border-radius: 6px;
  transition: all 0.2s ease;
}

.density-btn:hover {
  background: rgba(28, 126, 214, 0.1);
  color: var(--accent);
}

.density-btn.active {
  background: var(--accent);
  color: white;
  box-shadow: 0 2px 6px rgba(28, 126, 214, 0.3);
}

/* Density States */
[data-density="comfortable"] .cfi-table tbody td {
  padding: 10px 12px;
  font-size: 14px;
  line-height: 1.6;
}

[data-density="comfortable"] .cfi-kpi-item {
  padding: 18px 20px;
}

[data-density="comfortable"] .cfi-body.tight {
  padding: 16px 20px;
}

[data-density="dense"] .cfi-table tbody td {
  padding: 3px 8px;
  font-size: 11px;
  line-height: 1.3;
}

[data-density="dense"] .cfi-kpi-item {
  padding: 10px 12px;
  gap: 4px;
}

[data-density="dense"] .cfi-kpi-value {
  font-size: 18px;
}

[data-density="dense"] .cfi-body.tight {
  padding: 6px 10px;
}

/* Enhanced Tooltips */
.metric-tooltip {
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.tooltip-trigger {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: var(--accent-light);
  color: white;
  font-size: 10px;
  font-weight: 700;
  cursor: help;
  transition: all 0.2s ease;
}

.tooltip-trigger:hover {
  background: var(--accent);
  transform: scale(1.2);
}

.tooltip-content {
  position: absolute;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  padding: 12px 16px;
  background: var(--navy);
  color: white;
  border-radius: 8px;
  font: 400 13px/1.5 "Inter", sans-serif;
  white-space: nowrap;
  max-width: 320px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s ease, transform 0.2s ease;
  z-index: 1000;
}

.tooltip-content::after {
  content: '';
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 6px solid transparent;
  border-top-color: var(--navy);
}

.tooltip-trigger:hover + .tooltip-content,
.tooltip-content:hover {
  opacity: 1;
  transform: translateX(-50%) translateY(-4px);
}

/* Sparkline Charts in KPI Cards */
.kpi-sparkline {
  height: 24px;
  width: 100%;
  margin-top: 4px;
}

.kpi-sparkline-svg {
  width: 100%;
  height: 100%;
}

.sparkline-path {
  fill: none;
  stroke: var(--accent);
  stroke-width: 2;
  vector-effect: non-scaling-stroke;
}

.sparkline-path.positive {
  stroke: var(--green);
}

.sparkline-path.negative {
  stroke: var(--red);
}

.sparkline-area {
  fill: var(--accent);
  opacity: 0.1;
}

.sparkline-area.positive {
  fill: var(--green);
}

.sparkline-area.negative {
  fill: var(--red);
}

.sparkline-dot {
  fill: var(--accent);
  r: 2;
}

.sparkline-dot:last-child {
  r: 3;
  stroke: white;
  stroke-width: 2;
}

/* Number Count-up Animation */
.animated-number {
  display: inline-block;
  transition: all 0.3s ease;
}

@keyframes countUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.number-changing {
  animation: countUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Cross-Panel Highlighting */
.highlight-active {
  background: linear-gradient(135deg, rgba(28, 126, 214, 0.1) 0%, rgba(28, 126, 214, 0.05) 100%);
  outline: 2px solid var(--accent-light);
  outline-offset: 2px;
  transition: all 0.3s ease;
}

.highlight-related {
  background: linear-gradient(135deg, rgba(255, 127, 14, 0.08) 0%, rgba(255, 127, 14, 0.03) 100%);
  transition: all 0.3s ease;
}

/* Deep Link Indicator */
.deep-link-active {
  animation: pulseHighlight 2s ease-in-out 3;
}

@keyframes pulseHighlight {
  0%, 100% {
    box-shadow: 0 0 0 0 rgba(28, 126, 214, 0.4);
  }
  50% {
    box-shadow: 0 0 0 16px rgba(28, 126, 214, 0);
  }
}

/* Back to Top Button */
.back-to-top {
  position: fixed;
  bottom: 32px;
  right: 32px;
  width: 48px;
  height: 48px;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 8px 24px rgba(28, 126, 214, 0.3);
  opacity: 0;
  transform: translateY(100px);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 999;
}

.back-to-top.visible {
  opacity: 1;
  transform: translateY(0);
}

.back-to-top:hover {
  background: var(--accent-dark);
  transform: translateY(-4px);
  box-shadow: 0 12px 32px rgba(28, 126, 214, 0.4);
}

.back-to-top svg {
  width: 24px;
  height: 24px;
}

/* Loading Progress Bar */
.loading-progress {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: var(--grid);
  z-index: 10000;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.loading-progress.active {
  opacity: 1;
}

.loading-progress-bar {
  height: 100%;
  background: linear-gradient(90deg, var(--accent), var(--accent-light), var(--green));
  width: 0;
  transition: width 0.3s ease;
  box-shadow: 0 0 10px var(--accent-light);
}

.loading-progress-bar.indeterminate {
  width: 30%;
  animation: progressIndeterminate 1.5s ease-in-out infinite;
}

@keyframes progressIndeterminate {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(400%);
  }
}

/* Enhanced Accessibility */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.skip-to-content {
  position: absolute;
  top: -40px;
  left: 0;
  padding: 8px 16px;
  background: var(--accent);
  color: white;
  text-decoration: none;
  font-weight: 600;
  border-radius: 0 0 8px 0;
  z-index: 10000;
  transition: top 0.3s ease;
}

.skip-to-content:focus {
  top: 0;
}

/* Focus Visible Improvements */
*:focus-visible {
  outline: 3px solid var(--accent-light);
  outline-offset: 2px;
}

button:focus-visible,
a:focus-visible,
input:focus-visible,
select:focus-visible {
  outline: 3px solid var(--accent-light);
  outline-offset: 2px;
}

/* Reduced Motion Preference */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* High Contrast Mode */
@media (prefers-contrast: high) {
  :root {
    --border-color: rgba(0, 0, 0, 0.8);
  }
  
  .cfi-panel {
    border-width: 2px;
  }
  
  button,
  .export-button,
  .toolbar-button {
    border-width: 2px;
  }
}

/* Print Styles */
@media print {
  body {
    background: white;
    color: black;
  }
  
  .dashboard-toolbar,
  .header-actions,
  .export-button,
  .toolbar-button,
  .theme-toggle,
  .back-to-top,
  .density-control,
  .search-container,
  .data-freshness,
  .chart-actions,
  .strip-action,
  .toggle-panel-btn {
    display: none !important;
  }
  
  #cfi-root {
    padding: 0;
    grid-gap: 16px;
    max-width: 100%;
  }
  
  .cfi-panel {
    break-inside: avoid;
    page-break-inside: avoid;
    box-shadow: none;
    border: 1px solid #ddd;
    margin-bottom: 16px;
  }
  
  .cfi-panel::before {
    display: none;
  }
  
  .cfi-header {
    background: white !important;
    border: 1px solid #ddd !important;
  }
  
  .cfi-strip {
    background: #f0f0f0 !important;
    color: black !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
  
  .cfi-table {
    font-size: 10px;
  }
  
  .plot {
    page-break-inside: avoid;
  }
  
  /* Ensure charts are visible */
  .js-plotly-plot {
    break-inside: avoid;
  }
  
  /* Expand all collapsed sections for print */
  .collapsible-content.collapsed {
    max-height: none !important;
    opacity: 1 !important;
    padding: 20px !important;
  }
  
  /* Print page breaks */
  .cfi-panel[data-area="keyfin"] {
    page-break-after: always;
  }
  
  @page {
    margin: 1.5cm;
    size: A4 portrait;
  }
  
  @page :first {
    margin-top: 1cm;
  }
}

/* Mobile Touch Optimizations */
@media (hover: none) and (pointer: coarse) {
  .toolbar-button,
  .export-button,
  .cfi-kpi-item,
  button,
  select {
    min-height: 44px;
    min-width: 44px;
  }
  
  .tooltip-trigger {
    width: 24px;
    height: 24px;
  }
  
  /* Mobile: Show tooltips on tap */
  .tooltip-content {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    white-space: normal;
    max-width: calc(100vw - 40px);
  }
}

/* Confetti Animation (for positive milestones) */
@keyframes confetti-fall {
  0% {
    transform: translateY(-100vh) rotate(0deg);
    opacity: 1;
  }
  100% {
    transform: translateY(100vh) rotate(720deg);
    opacity: 0;
  }
}

.confetti-piece {
  position: fixed;
  width: 10px;
  height: 10px;
  background: var(--green);
  animation: confetti-fall 3s ease-in forwards;
  pointer-events: none;
  z-index: 9999;
}

/* Data Quality Badge */
.data-quality-indicator {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 8px;
  border-radius: 6px;
  font: 600 10px "Inter", sans-serif;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.data-quality-indicator.high {
  background: rgba(16, 185, 129, 0.1);
  color: var(--green);
}

.data-quality-indicator.medium {
  background: rgba(245, 158, 11, 0.1);
  color: #f59e0b;
}

.data-quality-indicator.low {
  background: rgba(239, 68, 68, 0.1);
  color: var(--red);
}

/* Quick Filter Buttons */
.quick-filters {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
}

.quick-filter-btn {
  padding: 6px 12px;
  border: 1px solid var(--border-color);
  border-radius: 6px;
  background: var(--card);
  color: var(--text-secondary);
  font: 600 11px "Inter", sans-serif;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.quick-filter-btn:hover {
  border-color: var(--accent);
  color: var(--accent);
  background: rgba(28, 126, 214, 0.05);
}

.quick-filter-btn.active {
  background: var(--accent);
  color: white;
  border-color: var(--accent);
}

/* Screenshot Mode */
.screenshot-mode {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

.screenshot-mode.active {
  opacity: 1;
  pointer-events: all;
}

.screenshot-frame {
  background: white;
  border-radius: 8px;
  box-shadow: 0 24px 60px rgba(0, 0, 0, 0.4);
  padding: 20px;
  max-width: 90vw;
  max-height: 90vh;
  overflow: auto;
}

/* Notification Toast */
.notification-toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  padding: 16px 20px;
  background: var(--card);
  border: 1px solid var(--border-color);
  border-radius: 12px;
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
  display: flex;
  align-items: center;
  gap: 12px;
  min-width: 300px;
  max-width: 420px;
  opacity: 0;
  transform: translateX(500px);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 9998;
}

.notification-toast.visible {
  opacity: 1;
  transform: translateX(0);
}

.notification-toast.success {
  border-left: 4px solid var(--green);
}

.notification-toast.error {
  border-left: 4px solid var(--red);
}

.notification-toast.info {
  border-left: 4px solid var(--accent);
}

.notification-icon {
  font-size: 24px;
  flex-shrink: 0;
}

.notification-content {
  flex: 1;
}

.notification-title {
  font: 600 14px "Inter", sans-serif;
  color: var(--text-primary);
  margin: 0 0 4px;
}

.notification-message {
  font: 400 13px "Inter", sans-serif;
  color: var(--text-secondary);
  margin: 0;
}

.notification-close {
  background: none;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  font-size: 20px;
  padding: 4px;
  border-radius: 4px;
  transition: all 0.2s ease;
}

.notification-close:hover {
  background: rgba(0, 0, 0, 0.05);
  color: var(--text-primary);
}

/* Currency Selector */
.currency-selector {
  display: flex;
  gap: 4px;
  padding: 4px;
  background: var(--card);
  border: 1px solid var(--border-color);
  border-radius: 8px;
}

.currency-btn {
  padding: 4px 10px;
  border: none;
  background: transparent;
  color: var(--text-secondary);
  font: 600 11px "Inter", sans-serif;
  cursor: pointer;
  border-radius: 6px;
  transition: all 0.2s ease;
}

.currency-btn:hover {
  background: rgba(28, 126, 214, 0.1);
  color: var(--accent);
}

.currency-btn.active {
  background: var(--accent);
  color: white;
}

/* Dark mode specific improvements for charts */
[data-theme="dark"] .cfi-body,
[data-theme="dark"] .plot {
  background: var(--card);
}

[data-theme="dark"] .overview-table .kv-label,
[data-theme="dark"] .meta-label {
  color: var(--text-secondary);
}

[data-theme="dark"] .overview-table .kv-value,
[data-theme="dark"] .meta-value {
  color: var(--accent-light);
}

[data-theme="dark"] .chart-action-btn,
[data-theme="dark"] .toolbar-button {
  background: var(--card);
  color: var(--text-primary);
  border-color: var(--border-color);
}

[data-theme="dark"] .shortcut-item {
  background: var(--card);
}

[data-theme="dark"] .shortcut-item kbd {
  background: var(--header-bg);
  border-color: var(--border-color);
  color: var(--text-primary);
}

/* Responsive improvements for new features */
@media (max-width: 768px) {
  .back-to-top {
    bottom: 20px;
    right: 20px;
    width: 44px;
    height: 44px;
  }
  
  .notification-toast {
    bottom: 16px;
    right: 16px;
    left: 16px;
    min-width: auto;
    max-width: none;
  }
  
  .density-control {
    width: 100%;
    justify-content: space-between;
  }
  
  .tooltip-content {
    white-space: normal;
    max-width: calc(100vw - 40px);
  }
}
